<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Control Parental Carlos</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/5833/5833290.png">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        :root {
            --bg: #0a0b10;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent: #00f2ff;
            --text: #ffffff;
            --text-dim: #8a8d9b;
            --red: #ff4757;
            --grad-mates: linear-gradient(135deg, #ff0080, #7928ca);
            --grad-lengua: linear-gradient(135deg, #00f2ff, #0061ff);
            --grad-default: linear-gradient(135deg, #434343, #232323);
        }

        body { 
            margin: 0; font-family: 'Inter', sans-serif; 
            background: var(--bg); color: var(--text); 
            height: 100vh; overflow: hidden; display: flex; flex-direction: column; 
        }
        
        header { padding: 65px 25px 20px; background: linear-gradient(to bottom, #1a1b25, var(--bg)); }
        .saludo { color: var(--accent); font-size: 18px; font-weight: 700; margin-bottom: 5px; text-shadow: 0 0 10px rgba(0, 242, 255, 0.3); }
        h1 { font-size: 32px; font-weight: 900; text-transform: uppercase; font-style: italic; margin: 0; line-height: 1; }
        h1 span { color: var(--accent); text-shadow: 0 0 20px rgba(0, 242, 255, 0.6); }
        
        main { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 160px; display: flex; flex-direction: column; }
        
        .task-card { 
            background: var(--glass); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); 
            border: 1px solid var(--glass-border); border-radius: 28px; padding: 22px; 
            margin-bottom: 18px; display: flex; align-items: center; 
            transition: all 0.3s ease;
        }

        .materia-badge { font-size: 11px; font-weight: 900; padding: 6px 14px; border-radius: 10px; margin-bottom: 12px; color: #fff; text-transform: uppercase; display: inline-block; }
        .task-info h3 { margin: 0; font-size: 20px; letter-spacing: -0.5px; }
        .due-date { background: rgba(255, 71, 87, 0.15); color: #ff4757; padding: 6px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-top: 12px; display: inline-block; }
        
        .actions { display: flex; flex-direction: column; gap: 10px; margin-left: auto; align-items: center; }

        .check-btn { 
            width: 55px; height: 55px; 
            background: rgba(255,255,255,0.07); border-radius: 18px; 
            display: flex; align-items: center; justify-content: center; 
            border: 1px solid var(--glass-border); font-size: 26px; cursor: pointer; 
        }
        
        .delete-btn {
            width: 40px; height: 40px;
            background: rgba(255, 71, 87, 0.1); border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            border: 1px solid rgba(255, 71, 87, 0.2); font-size: 18px; cursor: pointer;
            color: var(--red);
        }

        .completed { opacity: 0.4; transform: scale(0.96); order: 2; border-color: rgba(0, 255, 136, 0.2); }
        .completed .check-btn { background: #00ff88; color: #000; box-shadow: 0 0 20px rgba(0, 255, 136, 0.4); border: none; }
        .completed .due-date { background: rgba(0, 255, 136, 0.1); color: #00ff88; }

        .show-history .task-card:not(.completed) { display: none; }
        .show-pending .task-card.completed { display: none; }

        .fab { 
            position: fixed; bottom: 140px; right: 25px; 
            width: 80px; height: 80px; background: linear-gradient(45deg, var(--accent), #7000ff); 
            border-radius: 25px; display: flex; align-items: center; justify-content: center; 
            font-size: 45px; color: white; border: none; box-shadow: 0 10px 30px rgba(0, 242, 255, 0.5); z-index: 10; 
        }

        nav { 
            position: fixed; bottom: 0; width: 100%; height: 125px; 
            background: rgba(10, 11, 16, 0.95); backdrop-filter: blur(30px); 
            display: flex; justify-content: space-around; align-items: center; 
            border-top: 1px solid var(--glass-border); padding-bottom: 40px; 
        }
        .nav-item { color: var(--text-dim); border: none; background: none; display: flex; flex-direction: column; align-items: center; width: 33%; }
        .nav-icon { font-size: 42px; margin-bottom: 5px; }
        .nav-text { font-size: 12px; font-weight: 900; letter-spacing: 1px; }
        .nav-item.active { color: var(--accent); }
        .nav-item.active .nav-icon { filter: drop-shadow(0 0 15px var(--accent)); transform: scale(1.1); }
        
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; z-index: 100; align-items: flex-end; }
        .modal.active { display: flex; }
        .modal-content { background: #1a1b25; width: 100%; padding: 45px 25px; border-radius: 45px 45px 0 0; border-top: 5px solid var(--accent); box-sizing: border-box; }
        input, select { width: 100%; background: #2a2b35; border: 1px solid #444; padding: 22px; border-radius: 20px; color: white; margin-bottom: 20px; font-size: 18px; box-sizing: border-box; }
        .btn-save { width: 100%; background: var(--accent); color: #000; font-weight: 900; padding: 22px; border-radius: 20px; border: none; font-size: 18px; }
    </style>
</head>
<body class="show-pending">

    <header>
        <div class="saludo">Panel de Control:</div>
        <h1 id="title">Tareas <span>Carlos</span></h1>
    </header>

    <main id="container"></main>

    <button class="fab" onclick="toggleModal(true)">+</button>

    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 style="margin:0 0 25px 0">A√ëADIR MANUALMENTE</h2>
            <select id="materia">
                <option>Lengua Castellana</option><option>Educaci√≥n F√≠sica</option><option>F√≠sica y Qu√≠mica</option>
                <option>Geograf√≠a e Historia</option><option>Ingl√©s</option><option>Matem√°ticas</option>
                <option>M√∫sica</option><option>Portugu√©s</option><option>Valores</option>
                <option>Religi√≥n</option><option>Tecnolog√≠a</option>
            </select>
            <input type="text" id="desc" placeholder="¬øQu√© tiene que hacer Carlos?">
            <input type="date" id="fecha">
            <button class="btn-save" id="btnGuardar">A√±adir a su lista</button>
            <button onclick="toggleModal(false)" style="width:100%; background:none; border:none; color:var(--text-dim); margin-top:20px; font-weight:bold;">CANCELAR</button>
        </div>
    </div>

    <nav>
        <button class="nav-item active" onclick="setView('pending', this)">
            <span class="nav-icon">üìã</span><span class="nav-text">PENDIENTES</span>
        </button>
        <button class="nav-item" onclick="setView('history', this)">
            <span class="nav-icon">üïí</span><span class="nav-text">HISTORIAL</span>
        </button>
        <button class="nav-item" onclick="alert('Sincronizaci√≥n con Classroom activa üì°')">
            <span class="nav-icon">üì°</span><span class="nav-text">ROBOT</span>
        </button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAX73SwswrGbnWS1E1il45X1mJUai4H5os",
            authDomain: "classroomapp-d3127.firebaseapp.com",
            projectId: "classroomapp-d3127",
            storageBucket: "classroomapp-d3127.firebasestorage.app",
            messagingSenderId: "150299771144",
            appId: "1:150299771144:web:617197689e333ba26d2cbd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tareasRef = collection(db, "tareas");

        // Guardar Manual
        document.getElementById('btnGuardar').onclick = async () => {
            const d = document.getElementById('desc').value;
            const f = document.getElementById('fecha').value;
            if(!d || !f) return alert("Falta descripci√≥n o fecha");
            try {
                await addDoc(tareasRef, {
                    materia: document.getElementById('materia').value,
                    desc: d, fecha: f, completada: false, createdAt: Date.now()
                });
                toggleModal(false);
                document.getElementById('desc').value = "";
            } catch (e) { alert("Error de conexi√≥n con Firebase"); }
        };

        window.toggleCheck = async (id, estado) => {
            await updateDoc(doc(db, "tareas", id), { completada: !estado });
        };

        window.eliminarTarea = async (id) => {
            if(confirm("¬øSeguro que quieres borrar esta tarea?")) {
                await deleteDoc(doc(db, "tareas", id));
            }
        };

        // Renderizado inteligente (Soporta tareas de Classroom y manuales)
        const q = query(tareasRef, orderBy("completada", "asc"), orderBy("fecha", "asc"));
        onSnapshot(q, (snapshot) => {
            const cont = document.getElementById('container');
            cont.innerHTML = "";
            snapshot.forEach((snap) => {
                const raw = snap.data();
                const id = snap.id;
                
                // Normalizador para que los datos del Robot se lean igual que los manuales
                const t = {
                    materia: raw.materia?.stringValue || raw.materia || "General",
                    desc: raw.desc?.stringValue || raw.desc || "Sin descripci√≥n",
                    fecha: raw.fecha?.stringValue || raw.fecha || "Pendiente",
                    completada: raw.completada?.booleanValue || raw.completada || false
                };

                const card = document.createElement('div');
                card.className = `task-card ${t.completada ? 'completed' : ''}`;
                
                let grad = "var(--grad-default)";
                if(t.materia.includes("Mat") || t.materia.includes("F√≠sica")) grad = "var(--grad-mates)";
                if(t.materia.includes("Leng") || t.materia.includes("Ing")) grad = "var(--grad-lengua)";

                card.innerHTML = `
                    <div style="flex:1">
                        <div class="materia-badge" style="background:${grad}">${t.materia}</div>
                        <h3 style="margin:0; font-size:18px;">${t.desc}</h3>
                        <div class="due-date">${t.completada ? '‚úÖ REALIZADO' : '‚è≥ ENTREGA: ' + t.fecha}</div>
                    </div>
                    <div class="actions">
                        <div class="check-btn" onclick="toggleCheck('${id}', ${t.completada})">${t.completada ? '‚úì' : '+'}</div>
                        <div class="delete-btn" onclick="eliminarTarea('${id}')">üóëÔ∏è</div>
                    </div>
                `;
                cont.appendChild(card);
            });
        });

        function toggleModal(s) { document.getElementById('modal').classList.toggle('active', s); }
        window.toggleModal = toggleModal;

        window.setView = (v, el) => {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            document.body.className = v === 'pending' ? 'show-pending' : 'show-history';
            document.getElementById('title').innerHTML = v === 'pending' ? 'Tareas <span>Carlos</span>' : 'Historial <span>Carlos</span>';
        };
    </script>
</body>
</html>